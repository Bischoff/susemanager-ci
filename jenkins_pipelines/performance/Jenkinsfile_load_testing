#!/usr/bin/env groovy

// Configure the build properties
properties([
    buildDiscarder(logRotator(numToKeepStr: '500', daysToKeepStr: '4')),
    disableConcurrentBuilds(),
])

pipeline {
    // run wheere there is already terraform client installed
    agent { label 'sumaform-cucumber' }
    stages {
        stage('Deploy Locust on cloud') {
            steps {
                  // take the gitlab runner and execute the main.tf
                  git url: 'https://gitlab.suse.de/galaxy/sumaform-test-runner'
                  bash '''#!/bin/bash
                  cd performance
                  git clone --depth 1 https://github.com/moio/sumaform.git'
                  pwd 
	 	  terraform init
                  terraform plan
                  '''
                  // sh 'terraform apply'
                  }
        }
        // Run locust tests.
        stage('execute Locust tests') {
            steps {
                  echo 'log in locust node and run the tests'
                  }
        }
    }
  post { 
        always { 
              echo 'post-actions'
   //         sh 'terraform destroy'
   //         cleanWs()
        }
    }
}
